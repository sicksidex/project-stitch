<!DOCTYPE html>
<html>
<head>
    <title>Experiment</title>
        <meta content="width=device-width,minimum-scale=1,maximum-scale=1" name="viewport">
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="http://twitter.github.com/bootstrap/assets/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.js"></script>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
        <script type="text/javascript">
            //<![CDATA[ 
            $(window).load(function () {
                changeContent = function (key) {
                    html = textHash[key];
                    $('#content').html(html);
                }

                $("#menubutton a").click(function (e) {
                    $('#menu').collapse('hide');
                    changeContent(e.target.innerText);
                });

                textHash = {
                    "Device 1": "<h1>You Have Selected Device 1</h1>",
                    "Device 2": "<h1>You Have Selected Device 2</h1>",
                    "Device 3": "<h1>You Have Selected Device 3</h1>"
                };
            });//]]>  
    </script>
    <style type="text/css">

    </style>
    <script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?sensor=true">
    </script>
    <script type="text/javascript">

        function initialize() {
            var socket = new WebSocket("ws://10.1.1.8:8182");
            var zoomMaster = 5;
            var mDPI;
            var mWidthInch;
            var totalWidthL = 0;
            var totalWidthR = 0;
            var devicesCount = 0;

            var mapOptions = {
                center: new google.maps.LatLng(-34.397433, 150.111),
                zoom: zoomMaster,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                mapTypeControl: true
            };
            var map = new google.maps.Map(document.getElementById("map_canvas"),
                mapOptions);

            getDimensions();
            socket.onopen = function () { };
            socket.onmessage = function (msg) { recieve(msg.data); };

            google.maps.event.addListener(map, 'center_changed', function () { recenterMaps(); });

            google.maps.event.addListener(map, 'zoom_changed', function () {
                zoomMaster = map.getZoom();
                recenterMaps();
            });

            google.maps.event.addListener(map, 'maptypeid_changed', function () {
                var mapType = map.getMapTypeId();
                send("lay," + mapType);
            });

            function getDimensions() {
                var p = window.devicePixelRatio;
                var mWidthPixel = window.screen.width * p;
                var mHeightPixel = window.screen.height * p;
                mDPI = p * 155;
                mWidthInch = mWidthPixel / mDPI;
                addWidth(mWidthInch.toFixed(4), "L");
                addWidth(mWidthInch.toFixed(4), "R");
            }

            function addWidth(width, dir) {
                var bezel = (width * 7.5) / 100;
                if (dir == "L") {
                    totalWidthL = totalWidthL + (width / 2) + bezel;
                } else {
                    totalWidthR = totalWidthR + (width / 2) + bezel;
                }
            }

            function recieve(msg) {
                var data = msg.split(",");

                switch (data[0]) {
                    case "mas":
                        devicesCount++;
                        addWidth(data[1], data[2]);
                        if (data[2] == "L") {
                            send("ini," + devicesCount + "," + totalWidthL);
                        } else {
                            send("ini," + devicesCount + "," + totalWidthR);
                        }
                        addWidth(data[1], data[2]);
                        recenterMaps();
                        break;
                    case "slv":
                        var zoom = parseInt(data[1]);
                        if (zoom != zoomMaster) {
                            zoomMaster = zoom;
                            map.setZoom(zoom);
                        }
                        var lat = data[2];
                        var lng = data[3];
                        var newCenter = new google.maps.LatLng(lat, lng);
                        map.setCenter(newCenter);
                        break;
                }

            }

            function recenterMaps() {
                var center = map.getCenter();
                var centerLat = center.lat();
                var centerLng = center.lng();
                send("pos," + zoomMaster + "," + centerLat.toFixed(8) + "," + centerLng.toFixed(8));
            }

            function send(msg) {
                socket.send(msg);
            }
        }
    </script>
</head>
<body onload="initialize()">
    <div id="map_canvas"></div>
      <button id="btn1">Menu</button>
    <div id="container">
<div id="hidediv">
        <div class="viewport">
      <div class="frame">
        <div id="menu" class="menu nav-collapse collapse width">
          <div class="collapse-inner">
            <div class="navbar navbar-inverse">
              <div class="navbar-inner">
                Menu
              </div>
            </div>
            <ul class="nav nav-tabs nav-stacked">
              <li><a>Device 1</a></li>
              <li><a>Device 2</a></li>
              <li><a>Device 3</a></li>
            </ul>
                <button id="btn2">Close Menu</button>
          </div>
        </div>
        <div class="view">
          <div class="navbar navbar-inverse">
            <div class="navbar-inner">
              <button id="menubutton" type="button" class="btn btn-navbar" data-toggle="collapse" data-target="#menu">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>
                      <script>
                          $('#container').hide();
                          $("#btn1").click(function () {
                              $("#container").toggle({ effect: "fold", size: "40" });
                              $('#btn1').hide();

                          });
                          $("#btn2").click(function () {
                              $("#container").toggle({ effect: "fold", horizFirst: "False", size: "40" });
                              $('#btn1').show();
                              $('#menu').hide();
                          });
                          $("#menubutton").click(function () {
                              $("#menu").show();
                          });



</script>
        </div>
</body>
</html>